<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily weather interpolation over Senegal • meteoland</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Daily weather interpolation over Senegal">
<meta property="og:description" content="meteoland">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">meteoland</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li>
  <a href="../../articles/index.html">Articles</a>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="InterpolationSenegal_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Daily weather interpolation over Senegal</h1>
                        <h4 data-toc-skip class="author">Miquel De Cáceres</h4>
            
            <h4 data-toc-skip class="date">2022-05-17</h4>
      
      
      <div class="hidden name"><code>InterpolationSenegal.Rmd</code></div>

    </div>

    
    
<p>In this document we show how to obtain and process the topographic and weather data needed by package <strong>meteoland</strong> to conduct weather interpolation over a given country. We’ll use Senegal as case study.</p>
<div class="section level2">
<h2 id="accessing-weather-station-data">Accessing weather station data<a class="anchor" aria-label="anchor" href="#accessing-weather-station-data"></a>
</h2>
<p>We start by loading package <strong>worldmet</strong>, which provides access to over 30.000 weather stations across the globe:</p>
<p>In order to download weather data, we must first obtain the codes of the weather stations available for our study area. This can be done using function <code>getMeta()</code> from worldmet, which we use to know available weather stations for Senegal and neighbouring countries:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Country codes for Senegal / Gambia/ Guinea/ Mali/ Mauritania /Guinea bissau</span>
<span class="va">countries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SG"</span>, <span class="st">"GA"</span>, <span class="st">"GV"</span>, <span class="st">"ML"</span>, <span class="st">"MR"</span>, <span class="st">"PU"</span><span class="op">)</span>
<span class="va">sg_st</span> <span class="op">=</span> <span class="fu">getMeta</span><span class="op">(</span>country<span class="op">=</span><span class="va">countries</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </code></pre></div>
<p>Here are the stations downloaded:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sg_st</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 47 × 12</span></span>
<span class="co">##    usaf  wban  station ctry  st    call  latitude longitude `elev(m)` begin     </span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> 6121… 99999 KIDAL   ML    <span style="color: #BB0000;">NA</span>    GAKL      18.4     1.35      459   1957-03-05</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> 6122… 99999 TOMBOU… ML    <span style="color: #BB0000;">NA</span>    GATB      16.7    -<span style="color: #BB0000;">3.01</span>      263   1949-04-11</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> 6122… 99999 GAO     ML    <span style="color: #BB0000;">NA</span>    GAGO      16.2    -<span style="color: #BB0000;">0.005</span>     265.  1949-04-01</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> 6123… 99999 NIORO … ML    <span style="color: #BB0000;">NA</span>    GANR      15.2    -<span style="color: #BB0000;">9.35</span>      237   1949-04-06</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> 6123… 99999 NARA/K… ML    <span style="color: #BB0000;">NA</span>    GANK      15.2    -<span style="color: #BB0000;">7.28</span>      265   1978-02-01</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> 6123… 99999 YELIMA… ML    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        15.1   -<span style="color: #BB0000;">10.6</span>       100   1990-10-01</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> 6125… 99999 KAYES/… ML    <span style="color: #BB0000;">NA</span>    GAKD      14.5   -<span style="color: #BB0000;">11.4</span>        51.5 1949-04-03</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> 6126… 99999 AMBODE… ML    <span style="color: #BB0000;">NA</span>    GAMB      14.5    -<span style="color: #BB0000;">4.08</span>      276.  1949-04-03</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> 6127… 99999 KITA    ML    <span style="color: #BB0000;">NA</span>    GAKT      13.1    -<span style="color: #BB0000;">9.47</span>      334   1957-01-05</span>
<span class="co">## <span style="color: #BCBCBC;">10</span> 6127… 99999 SEGOU   ML    <span style="color: #BB0000;">NA</span>    GASG      13.4    -<span style="color: #BB0000;">6.15</span>      289   1949-04-06</span>
<span class="co">## <span style="color: #949494;"># … with 37 more rows, and 2 more variables: end &lt;date&gt;, code &lt;chr&gt;</span></span></code></pre>
<p>Let’s assume that we want to interpolate weather for year 2020. We can download hourly weather station data for the selected stations and year 2020 using function <code>importNOAA()</code>:</p>
<p>Some stations had missing data for year 2020 and were excluded from the output. Using function <code><a href="../../reference/reshapeworldmet.html">reshapeworldmet()</a></code> from meteoland, we can reshape the hourly data of the remaining stations into daily data in form of an object <code>SpatialPointsMeteorology</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spt_sen</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/reshapeworldmet.html">reshapeworldmet</a></span><span class="op">(</span><span class="va">hourData</span>, output <span class="op">=</span> <span class="st">"SpatialPointsMeteorology"</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="va">spt_sen</span></code></pre></div>
<pre><code><span class="co">## Object of class SpatialPointsMeteorology</span>
<span class="co">## Dates:  367  (initial: 2020-01-01 final: 2021-01-01)</span>
<span class="co">## SpatialPoints:</span>
<span class="co">##                     lon      lat</span>
<span class="co">## 612300-99999  -9.350000 15.23333</span>
<span class="co">## 612330-99999  -7.283333 15.16667</span>
<span class="co">## 612350-99999 -10.566667 15.11667</span>
<span class="co">## 612570-99999 -11.439700 14.48167</span>
<span class="co">## 612650-99999  -4.079561 14.51280</span>
<span class="co">## 612700-99999  -9.466667 13.06667</span>
<span class="co">## 612720-99999  -6.150000 13.40000</span>
<span class="co">## 612770-99999  -4.833333 13.33333</span>
<span class="co">## 612910-99999  -7.949944 12.53354</span>
<span class="co">## 612930-99999  -5.466667 12.38333</span>
<span class="co">## 612960-99999  -7.500000 11.41667</span>
<span class="co">## 612970-99999  -5.683333 11.35000</span>
<span class="co">## 614420-99999 -15.947956 18.09786</span>
<span class="co">## 616000-99999 -16.463172 16.05076</span>
<span class="co">## 616120-99999 -14.966667 16.65000</span>
<span class="co">## 616270-99999 -15.116667 15.38333</span>
<span class="co">## 616300-99999 -13.250000 15.65000</span>
<span class="co">## 616410-99999 -17.490225 14.73971</span>
<span class="co">## 616660-99999 -16.233333 14.65000</span>
<span class="co">## 616790-99999 -16.051297 14.14688</span>
<span class="co">## 616870-99999 -13.653122 13.73682</span>
<span class="co">## 616950-99999 -16.281783 12.55562</span>
<span class="co">## 616970-99999 -16.746125 12.41020</span>
<span class="co">## 616980-99999 -14.966667 12.88333</span>
<span class="co">## 616990-99999 -12.220333 12.57229</span>
<span class="co">## 617010-99999 -16.652206 13.33796</span>
<span class="co">## 617050-99999 -16.200000 13.21667</span>
<span class="co">## 617070-99999 -15.566667 13.48333</span>
<span class="co">## 617220-99999 -15.933333 13.56667</span>
<span class="co">## 617310-99999 -14.216667 13.31667</span>
<span class="co">## 617660-99999 -15.653681 11.89485</span>
<span class="co">## 617690-99999 -15.483333 11.58333</span>
<span class="co">## 617810-99999 -14.666667 12.18333</span></code></pre>
<pre><code><span class="co">## Warning in proj4string(x): CRS object has comment, which is lost in output; in tests, see</span>
<span class="co">## https://cran.r-project.org/web/packages/sp/vignettes/CRS_warnings.html</span></code></pre>
<pre><code><span class="co">## Coordinate Reference System (CRS) arguments: +proj=longlat +datum=WGS84</span>
<span class="co">## +no_defs</span></code></pre>
<p>We can display the time series of one of the weather stations using</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../../reference/meteoplot.html">meteoplot</a></span><span class="op">(</span><span class="va">spt_sen</span>, <span class="fl">5</span>, <span class="st">"MeanTemperature"</span>, ylab <span class="op">=</span><span class="st">"Mean temperature (ºC)"</span><span class="op">)</span></code></pre></div>
<p><img src="InterpolationSenegal_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>While <code>SpatialPointsMeteorology</code> is the class that meteoland uses for point weather series, a special object of class <code>MeteorologyInterpolationData</code> needs to be created for interpolation, containing not only station weather but also station elevation and interpolation parameters. This can be obtained using the same function <code><a href="../../reference/reshapeworldmet.html">reshapeworldmet()</a></code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spt_mid</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/reshapeworldmet.html">reshapeworldmet</a></span><span class="op">(</span><span class="va">hourData</span>, output <span class="op">=</span> <span class="st">"MeteorologyInterpolationData"</span>, 
                         proj4string <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/CRS-class.html" class="external-link">CRS</a></span><span class="op">(</span>SRS_string <span class="op">=</span><span class="st">"EPSG:32628"</span><span class="op">)</span>,
                         verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Note that we specified a coordinate reference system (CRS) to UTM28N (via EPSG initialization). This is because interpolation should be preferably conducted on a projected with easting and northing in meters.</p>
</div>
<div class="section level2">
<h2 id="accessing-elevation-data">Accessing elevation data<a class="anchor" aria-label="anchor" href="#accessing-elevation-data"></a>
</h2>
<p>To perform weather interpolation, we need the topography (elevation, slope, aspect) of the target area. We can use function <code>getData()</code> from package <strong>raster</strong> to download elevation data for Senegal:</p>
<pre><code><span class="co">## class      : RasterLayer </span>
<span class="co">## dimensions : 552, 756, 417312  (nrow, ncol, ncell)</span>
<span class="co">## resolution : 0.008333333, 0.008333333  (x, y)</span>
<span class="co">## extent     : -17.6, -11.3, 12.2, 16.8  (xmin, xmax, ymin, ymax)</span>
<span class="co">## crs        : +proj=longlat +datum=WGS84 +no_defs </span>
<span class="co">## source     : SEN_msk_alt.grd </span>
<span class="co">## names      : SEN_msk_alt </span>
<span class="co">## values     : -13, 535  (min, max)</span></code></pre>
<p>The previous function returns a <code>RasterLayer</code> grid object in geographic coordinates, which we can plot along with the weather station point locations:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">elev_raster</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">spt_sen</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="InterpolationSenegal_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>In order to estimate slope and aspect it is important that the spatial reference system is in coordinates that have meters as units. We can reproject our raster to 28N UTM using function <code>projectRaster()</code> from package <strong>raster</strong>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">elev_utm</span> <span class="op">=</span> <span class="fu">projectRaster</span><span class="op">(</span><span class="va">elev_raster</span>, crs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/CRS-class.html" class="external-link">CRS</a></span><span class="op">(</span>SRS_string <span class="op">=</span><span class="st">"EPSG:32628"</span><span class="op">)</span><span class="op">)</span>
<span class="va">elev_utm</span></code></pre></div>
<pre><code><span class="co">## class      : RasterLayer </span>
<span class="co">## dimensions : 566, 774, 438084  (nrow, ncol, ncell)</span>
<span class="co">## resolution : 898, 922  (x, y)</span>
<span class="co">## extent     : 212597.7, 907649.7, 1343873, 1865725  (xmin, xmax, ymin, ymax)</span>
<span class="co">## crs        : +proj=utm +zone=28 +datum=WGS84 +units=m +no_defs </span>
<span class="co">## source     : memory</span>
<span class="co">## names      : SEN_msk_alt </span>
<span class="co">## values     : -6.424461, 506.9934  (min, max)</span></code></pre>
<p>Package meteoland allows deriving slope and aspect from elevation (i.e. DEM) data when builidng objects of class <code>SpatialGridTopography</code>. To this aim, we need first to cast our <code>RasterLayer</code> object into a <code>SpatialGridDataFrame</code> and then call function <code><a href="../../reference/SpatialGridTopography.html">SpatialGridTopography()</a></code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">elev_sgd</span> <span class="op">=</span> <span class="fu">as</span><span class="op">(</span><span class="va">elev_utm</span>, <span class="st">"SpatialGridDataFrame"</span><span class="op">)</span>
<span class="va">sgt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/SpatialGridTopography.html">SpatialGridTopography</a></span><span class="op">(</span><span class="va">elev_sgd</span><span class="op">@</span><span class="va">grid</span>, elevation <span class="op">=</span> <span class="va">elev_sgd</span><span class="op">$</span><span class="va">SEN_msk_alt</span>, 
                             proj4string <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/is.projected.html" class="external-link">proj4string</a></span><span class="op">(</span><span class="va">elev_sgd</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning in proj4string(elev_sgd): CRS object has comment, which is lost in output; in tests, see</span>
<span class="co">## https://cran.r-project.org/web/packages/sp/vignettes/CRS_warnings.html</span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sgt</span></code></pre></div>
<pre><code><span class="co">## Object of class SpatialGridTopography</span>
<span class="co">## Grid topology:</span>
<span class="co">##    cellcentre.offset cellsize cells.dim</span>
<span class="co">## s1          213046.7      898       774</span>
<span class="co">## s2         1344334.4      922       566</span></code></pre>
<pre><code><span class="co">## Warning in proj4string(x): CRS object has comment, which is lost in output; in tests, see</span>
<span class="co">## https://cran.r-project.org/web/packages/sp/vignettes/CRS_warnings.html</span></code></pre>
<pre><code><span class="co">## Coordinate Reference System (CRS) arguments: +proj=utm +zone=28</span>
<span class="co">## +datum=WGS84 +units=m +no_defs </span>
<span class="co">## </span>
<span class="co">## Topography summary:</span>
<span class="co">##    elevation          slope            aspect      </span>
<span class="co">##  Min.   : -6.42   Min.   :0.00     Min.   : -1.0   </span>
<span class="co">##  1st Qu.: 30.42   1st Qu.:0.06     1st Qu.:104.2   </span>
<span class="co">##  Median : 47.81   Median :0.15     Median :196.3   </span>
<span class="co">##  Mean   : 52.81   Mean   :0.22     Mean   :191.6   </span>
<span class="co">##  3rd Qu.: 62.26   3rd Qu.:0.31     3rd Qu.:287.4   </span>
<span class="co">##  Max.   :506.99   Max.   :8.55     Max.   :360.0   </span>
<span class="co">##  NA's   :199234   NA's   :199234   NA's   :199234</span></code></pre>
<p>The spatial grid contains many grid cells falling on the sea. We can exclude them by transforming our topography to class <code>SpatialPixelsTopography</code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spxt</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="va">sgt</span>, <span class="st">"SpatialPixelsTopography"</span><span class="op">)</span></code></pre></div>
<p>This new object has almost half the number of pixels of the original grid:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">sgt</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 438084      2</span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">spxt</span><span class="op">@</span><span class="va">coords</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 238850      2</span></code></pre>
<p>We can check the slope and aspect calculated by meteoland using plot functions:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/sp/man/spplot.html" class="external-link">spplot</a></span><span class="op">(</span><span class="va">spxt</span>, <span class="st">"slope"</span><span class="op">)</span></code></pre></div>
<p><img src="InterpolationSenegal_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/sp/man/spplot.html" class="external-link">spplot</a></span><span class="op">(</span><span class="va">spxt</span>, <span class="st">"aspect"</span><span class="op">)</span></code></pre></div>
<p><img src="InterpolationSenegal_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="performing-interpolation">Performing interpolation<a class="anchor" aria-label="anchor" href="#performing-interpolation"></a>
</h2>
<p>We are now ready to perform the interpolation of weather over the study area. Since our spatial target are grid pixels, we need to call function <code>interpolationpixels</code> with: (a) our object <code>MeteorologyInterpolationData</code>; (b) our target topography (i.e. in this case <code>SpatialPixelsTopography</code>); and (c) a vector of dates (here two distinct days) among the period with available data (year 2020):</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/interpolationpoints.html">interpolationpixels</a></span><span class="op">(</span><span class="va">spt_mid</span>, <span class="va">spxt</span>, dates<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2020-03-15"</span>, <span class="st">"2020-07-30"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning in proj4string(pixels): CRS object has comment, which is lost in output; in tests, see</span>
<span class="co">## https://cran.r-project.org/web/packages/sp/vignettes/CRS_warnings.html</span></code></pre>
<pre><code><span class="co">## Warning in proj4string(object): CRS object has comment, which is lost in output; in tests, see</span>
<span class="co">## https://cran.r-project.org/web/packages/sp/vignettes/CRS_warnings.html</span></code></pre>
<pre><code><span class="co">## Warning in interpolationpixels(spt_mid, spxt, dates = as.Date(c("2020-03-15", :</span>
<span class="co">## Boundary box of target grid is not within boundary box of interpolation data</span>
<span class="co">## object.</span></code></pre>
<pre><code><span class="co">## Interpolating day '2020-03-15' (1/2) -  done.</span>
<span class="co">## Interpolating day '2020-07-30' (2/2) -  done.</span></code></pre>
<p>A warning is launched because some grid points (hopefully not many) are outside the boundary box of the station data. At this point the resulting data can be exported via netCDF, displayed using function <code>spplot</code> or transformed into other spatio-temporal spatial structures. Here we will first transform the output to package <code>stars</code>:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mid_stars</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="va">mid</span>, <span class="st">"stars"</span><span class="op">)</span></code></pre></div>
<p>Now we use plot functions defined for stars objects to display mean daily temperature interpolation estimates:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mid_stars</span><span class="op">[</span><span class="st">"MeanTemperature"</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p><img src="InterpolationSenegal_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<p>As well as those for relative humidity:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mid_stars</span><span class="op">[</span><span class="st">"MeanRelativeHumidity"</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p><img src="InterpolationSenegal_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<p>And radiation in MJ/day:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mid_stars</span><span class="op">[</span><span class="st">"Radiation"</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p><img src="InterpolationSenegal_files/figure-html/unnamed-chunk-22-1.png" width="700"> Note that in the case of date “2020-07-30”, there was a prediction of rain in some areas, which decreases the estimated daily radiation.</p>
</div>
<div class="section level2">
<h2 id="exporting-the-result">Exporting the result<a class="anchor" aria-label="anchor" href="#exporting-the-result"></a>
</h2>
<p>Finally, we can export the interpolation result back on a netCDF, for its use in other software:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../../reference/writemeteorologygrid.html">writemeteorologypixels</a></span><span class="op">(</span><span class="va">mid</span>, <span class="st">"foo.nc"</span>, overwrite <span class="op">=</span> <span class="cn">T</span>, verbose<span class="op">=</span><span class="cn">T</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## Creating 'foo.nc'.</span></code></pre>
<pre><code><span class="co">## Warning in proj4string(object): CRS object has comment, which is lost in output; in tests, see</span>
<span class="co">## https://cran.r-project.org/web/packages/sp/vignettes/CRS_warnings.html</span></code></pre>
<pre><code><span class="co">## </span>
<span class="co">## Closing 'foo.nc'.</span></code></pre>
<p>For example, this can be read from package raster:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a</span> <span class="op">=</span> <span class="fu">raster</span><span class="op">(</span><span class="st">"foo.nc"</span>, var <span class="op">=</span> <span class="st">"MeanRelativeHumidity"</span>, band <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">a</span></code></pre></div>
<pre><code><span class="co">## class      : RasterLayer </span>
<span class="co">## band       : 2  (of  2  bands)</span>
<span class="co">## dimensions : 566, 774, 438084  (nrow, ncol, ncell)</span>
<span class="co">## resolution : 898, 922  (x, y)</span>
<span class="co">## extent     : 212597.7, 907649.7, 1343873, 1865725  (xmin, xmax, ymin, ymax)</span>
<span class="co">## crs        : NA </span>
<span class="co">## source     : foo.nc </span>
<span class="co">## names      : MeanRelativeHumidity </span>
<span class="co">## z-value    : 2020-07-30 </span>
<span class="co">## zvar       : MeanRelativeHumidity</span></code></pre>
<p>Note that the CRS is not read correctly. We can, however, plot the data.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span></code></pre></div>
<p><img src="InterpolationSenegal_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Miquel De Cáceres, Nicolas Martin, Víctor Granda, Antoine Cabon.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
