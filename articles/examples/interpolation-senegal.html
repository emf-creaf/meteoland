<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily weather interpolation over Senegal • meteoland</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Daily weather interpolation over Senegal">
<meta property="og:description" content="meteoland">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">meteoland</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li>
  <a href="../../articles/index.html">Articles</a>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Daily weather interpolation over Senegal</h1>
                        <h4 data-toc-skip class="author">Miquel De
Cáceres</h4>
            
            <h4 data-toc-skip class="date">2023-06-01</h4>
      
      
      <div class="hidden name"><code>interpolation-senegal.Rmd</code></div>

    </div>

    
    
<p>In this document we show how to obtain and process the topographic
and weather data needed by package <strong>meteoland</strong> to conduct
weather interpolation over a given country, using package
<strong>worldmet</strong> as source for reference weather station data.
We’ll use Senegal as case study.</p>
<p>We begin by loading necessary libraries, available in CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emf-creaf.github.io/meteoland/index.html" class="external-link">meteoland</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Package 'meteoland' [ver. 2.0.1]</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## terra 1.7.29</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/" class="external-link">stars</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: abind</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: sf</span></span></code></pre>
<pre><code><span><span class="co">## Linking to GEOS 3.10.2, GDAL 3.4.1, PROJ 8.2.1; sf_use_s2() is TRUE</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dieghernan.github.io/tidyterra/" class="external-link">tidyterra</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'tidyterra'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     filter</span></span></code></pre>
<p>We will also use package <strong>afrilearndata</strong> from GitHub,
to display African country limits:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># remotes::install_github("afrimapr/afrilearndata")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">afrilearndata</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="accessing-weather-station-data">Accessing weather station data<a class="anchor" aria-label="anchor" href="#accessing-weather-station-data"></a>
</h2>
<p>We start by loading package <strong>worldmet</strong>, which provides
access to over 30.000 weather stations across the globe:</p>
<p>In order to download weather data, we must first obtain the codes of
the weather stations available for our study area. This can be done
using function <code><a href="https://rdrr.io/pkg/worldmet/man/getMeta.html" class="external-link">getMeta()</a></code> from worldmet, which we use to
know available weather stations for Senegal and neighbouring
countries:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Country codes:</span></span>
<span><span class="co">#   Senegal - SG</span></span>
<span><span class="co">#   Gambia - GA </span></span>
<span><span class="co">#   Guinea - GV</span></span>
<span><span class="co">#   Mali - ML </span></span>
<span><span class="co">#   Mauritania - MR</span></span>
<span><span class="co">#   Guinea bissau - PU</span></span>
<span><span class="va">sg_st</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="fu">worldmet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/worldmet/man/getMeta.html" class="external-link">getMeta</a></span><span class="op">(</span>country<span class="op">=</span><span class="st">"SG"</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>                          <span class="fu">worldmet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/worldmet/man/getMeta.html" class="external-link">getMeta</a></span><span class="op">(</span>country<span class="op">=</span><span class="st">"GA"</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>                          <span class="fu">worldmet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/worldmet/man/getMeta.html" class="external-link">getMeta</a></span><span class="op">(</span>country<span class="op">=</span><span class="st">"GV"</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>                          <span class="fu">worldmet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/worldmet/man/getMeta.html" class="external-link">getMeta</a></span><span class="op">(</span>country<span class="op">=</span><span class="st">"ML"</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>                          <span class="fu">worldmet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/worldmet/man/getMeta.html" class="external-link">getMeta</a></span><span class="op">(</span>country<span class="op">=</span><span class="st">"MR"</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>                          <span class="fu">worldmet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/worldmet/man/getMeta.html" class="external-link">getMeta</a></span><span class="op">(</span>country<span class="op">=</span><span class="st">"PU"</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Here are the station data downloaded:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sg_st</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 57 × 12</span></span></span>
<span><span class="co">##    usaf  wban  station ctry  st    call  latitude longitude `elev(m)` begin     </span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 6160… 99999 SAINT … SG    <span style="color: #BB0000;">NA</span>    GOSS      16.1     -<span style="color: #BB0000;">16.5</span>       2.7 1949-04-01</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 6161… 99999 PODOR   SG    <span style="color: #BB0000;">NA</span>    GOSP      16.6     -<span style="color: #BB0000;">15.0</span>       7   1973-01-01</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 6162… 99999 LINGUE… SG    <span style="color: #BB0000;">NA</span>    GOOG      15.4     -<span style="color: #BB0000;">15.1</span>      21   1950-03-04</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 6163… 99999 MATAM/… SG    <span style="color: #BB0000;">NA</span>    GOSM      15.6     -<span style="color: #BB0000;">13.2</span>      17   1949-04-23</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 6164… 99999 LEOPOL… SG    <span style="color: #BB0000;">NA</span>    GOOY      14.7     -<span style="color: #BB0000;">17.5</span>      25.9 1943-04-01</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 6166… 99999 DIOURB… SG    <span style="color: #BB0000;">NA</span>    GOOD      14.6     -<span style="color: #BB0000;">16.2</span>       9   1950-02-06</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 6167… 99999 KAOLACK SG    <span style="color: #BB0000;">NA</span>    GOOK      14.1     -<span style="color: #BB0000;">16.1</span>       7.9 1950-02-05</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 6168… 99999 TAMBAC… SG    <span style="color: #BB0000;">NA</span>    GOTT      13.7     -<span style="color: #BB0000;">13.7</span>      49.1 1949-05-01</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 6169… 99999 ZIGUIN… SG    <span style="color: #BB0000;">NA</span>    GOGG      12.6     -<span style="color: #BB0000;">16.3</span>      22.9 1949-04-02</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 6169… 99999 CAP SK… SG    <span style="color: #BB0000;">NA</span>    GOGS      12.4     -<span style="color: #BB0000;">16.7</span>      15.8 1977-11-01</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 47 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 2 more variables: end &lt;date&gt;, code &lt;chr&gt;</span></span></span></code></pre>
<p>Let’s assume that we want to interpolate weather for year 2020. We
can download hourly weather station data for the selected stations and
year 2020 using function <code><a href="https://rdrr.io/pkg/worldmet/man/importNOAA.html" class="external-link">importNOAA()</a></code>:</p>
<p>Some stations had missing data for year 2020 and were excluded from
the output. Using function <code><a href="../../reference/worldmet2meteoland.html">worldmet2meteoland()</a></code> from
<strong>meteoland</strong>, we can reshape the hourly data of the
remaining stations into daily data in form of an <code>sf</code>
object:</p>
<p>An interpolator object needs to be created for interpolation,
containing not only station weather and topographic data but also
interpolation parameters. This can be obtained using function
<code><a href="../../reference/create_meteo_interpolator.html">create_meteo_interpolator()</a></code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interpolator_sen</span> <span class="op">&lt;-</span> <span class="fu">meteoland</span><span class="fu">::</span><span class="fu"><a href="../../reference/create_meteo_interpolator.html">create_meteo_interpolator</a></span><span class="op">(</span><span class="va">sf_sen</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Creating interpolator...</span></span></code></pre>
<pre><code><span><span class="co">## Warning: No interpolation parameters provided, using defaults</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Set the `params` argument to modify parameter default values</span></span></code></pre>
<pre><code><span><span class="co">## • Calculating smoothed variables...</span></span></code></pre>
<pre><code><span><span class="co">## • Updating intial_Rp parameter with the actual stations mean distance...</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Interpolator created.</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interpolator_sen</span></span></code></pre></div>
<pre><code><span><span class="co">## stars object with 2 dimensions and 13 attributes</span></span>
<span><span class="co">## attribute(s):</span></span>
<span><span class="co">##                                 Min.   1st Qu.     Median       Mean   3rd Qu.</span></span>
<span><span class="co">## Temperature               11.0000000 26.450000  28.537500  28.750958  30.91154</span></span>
<span><span class="co">## MinTemperature             8.5000000 21.000000  24.000000  23.712257  26.00000</span></span>
<span><span class="co">## MaxTemperature            11.0000000 31.000000  34.050000  34.322865  38.00000</span></span>
<span><span class="co">## RelativeHumidity           0.2667855 34.205043  57.318043  55.513283  77.66032</span></span>
<span><span class="co">## Precipitation              0.0000000  0.500000   3.750000  11.342697  13.00000</span></span>
<span><span class="co">## Radiation                  6.6175299 17.168025  19.766780  19.375520  22.35280</span></span>
<span><span class="co">## WindDirection              0.0000000 52.937535 192.002116 171.436844 270.00000</span></span>
<span><span class="co">## WindSpeed                  0.0000000  1.500000   2.311111   2.605188   3.31099</span></span>
<span><span class="co">## elevation                  1.0000000 17.000000  51.500000 172.636383 289.00000</span></span>
<span><span class="co">## aspect                     0.0000000  0.000000   0.000000   0.000000   0.00000</span></span>
<span><span class="co">## slope                      0.0000000  0.000000   0.000000   0.000000   0.00000</span></span>
<span><span class="co">## SmoothedPrecipitation      0.1000000  3.000000   8.000000  11.312237  14.66667</span></span>
<span><span class="co">## SmoothedTemperatureRange   0.0000000  5.555667   9.225806   9.525796  14.16504</span></span>
<span><span class="co">##                                 Max.  NA's</span></span>
<span><span class="co">## Temperature                 48.00000  3893</span></span>
<span><span class="co">## MinTemperature              48.00000  3893</span></span>
<span><span class="co">## MaxTemperature              48.20000  3893</span></span>
<span><span class="co">## RelativeHumidity           100.00000  3893</span></span>
<span><span class="co">## Precipitation              381.30000 15778</span></span>
<span><span class="co">## Radiation                   28.92108  3893</span></span>
<span><span class="co">## WindDirection              360.00000  4464</span></span>
<span><span class="co">## WindSpeed                   33.50000  3983</span></span>
<span><span class="co">## elevation                 1035.10000     0</span></span>
<span><span class="co">## aspect                       0.00000     0</span></span>
<span><span class="co">## slope                        0.00000     0</span></span>
<span><span class="co">## SmoothedPrecipitation      137.30000 12897</span></span>
<span><span class="co">## SmoothedTemperatureRange    21.40484  1816</span></span>
<span><span class="co">## dimension(s):</span></span>
<span><span class="co">##         from  to         offset  delta  refsys point</span></span>
<span><span class="co">## date       1 366 2020-01-01 UTC 1 days POSIXct FALSE</span></span>
<span><span class="co">## station    1  47             NA     NA  WGS 84  TRUE</span></span>
<span><span class="co">##                                                        values</span></span>
<span><span class="co">## date                                                     NULL</span></span>
<span><span class="co">## station POINT (-9.35 15.23333),...,POINT (-8.833333 7.733333)</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">africountries</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co"># geom_sf(data = sf::st_geometry(senegal_sf), fill= "red")+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">sf_sen</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">30</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="interpolation-senegal_files/figure-html/unnamed-chunk-12-1.png" width="384">
## Accessing elevation data</p>
<p>To perform weather interpolation, we need the topography (elevation,
slope, aspect) of the target area. We can use function
<code>getData()</code> from package <strong>raster</strong> to download
elevation data for Senegal:</p>
<pre><code><span><span class="co">## class       : SpatRaster </span></span>
<span><span class="co">## dimensions  : 564, 780, 1  (nrow, ncol, nlyr)</span></span>
<span><span class="co">## resolution  : 0.008333333, 0.008333333  (x, y)</span></span>
<span><span class="co">## extent      : -17.7, -11.2, 12.1, 16.8  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">## coord. ref. : lon/lat WGS 84 (EPSG:4326) </span></span>
<span><span class="co">## source      : SEN_elv_msk.tif </span></span>
<span><span class="co">## name        : SEN_elv_msk </span></span>
<span><span class="co">## min value   :          -7 </span></span>
<span><span class="co">## max value   :         542</span></span></code></pre>
<p>The previous function returns a <code>SpatRaster</code> object
(package <strong>terra</strong>), which we can plot using:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tidyterra</span><span class="fu">::</span><span class="fu"><a href="https://dieghernan.github.io/tidyterra/reference/geom_spatraster.html" class="external-link">geom_spatraster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">elev_raster</span><span class="op">)</span></span></code></pre></div>
<p><img src="interpolation-senegal_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>In order to estimate slope and aspect it is important that the
spatial reference system is in coordinates that have meters as units. We
can reproject our raster to 28N UTM using function
<code>projectRaster()</code> from package <strong>raster</strong>:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slope_raster</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/terrain.html" class="external-link">terrain</a></span><span class="op">(</span><span class="va">elev_raster</span>, v <span class="op">=</span> <span class="st">"slope"</span>, unit<span class="op">=</span><span class="st">"degrees"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tidyterra</span><span class="fu">::</span><span class="fu"><a href="https://dieghernan.github.io/tidyterra/reference/geom_spatraster.html" class="external-link">geom_spatraster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">slope_raster</span><span class="op">)</span></span></code></pre></div>
<p><img src="interpolation-senegal_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aspect_raster</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/terrain.html" class="external-link">terrain</a></span><span class="op">(</span><span class="va">elev_raster</span>, v <span class="op">=</span> <span class="st">"aspect"</span>, unit<span class="op">=</span><span class="st">"degrees"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tidyterra</span><span class="fu">::</span><span class="fu"><a href="https://dieghernan.github.io/tidyterra/reference/geom_spatraster.html" class="external-link">geom_spatraster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">aspect_raster</span><span class="op">)</span></span></code></pre></div>
<p><img src="interpolation-senegal_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fact</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">elev_raster</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"elevation"</span></span>
<span><span class="va">topo_spatraster_agg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">elev_raster</span>, fact <span class="op">=</span> <span class="va">fact</span><span class="op">)</span>, </span>
<span>                         <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">slope_raster</span>, fact <span class="op">=</span> <span class="va">fact</span><span class="op">)</span>, </span>
<span>                         <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">aspect_raster</span>, fact <span class="op">=</span> <span class="va">fact</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">topo_stars_agg</span> <span class="op">&lt;-</span> <span class="fu">stars</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_as_stars.html" class="external-link">st_as_stars</a></span><span class="op">(</span><span class="va">topo_spatraster_agg</span>, as_attributes<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="performing-interpolation">Performing interpolation<a class="anchor" aria-label="anchor" href="#performing-interpolation"></a>
</h2>
<p>We are now ready to perform the interpolation of weather over the
study area. Since our spatial target are grid pixels, we need to call
function <code>interpolationpixels</code> with: (a) our object
<code>MeteorologyInterpolationData</code>; (b) our target topography
(i.e. in this case <code>SpatialPixelsTopography</code>); and (c) a
vector of dates (here two distinct days) among the period with available
data (year 2020):</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">raster_interpolated</span> <span class="op">&lt;-</span> <span class="va">topo_stars_agg</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../../reference/interpolate_data.html">interpolate_data</a></span><span class="op">(</span><span class="va">interpolator_sen</span>, dates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-07-01"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                   verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Some points are outside the convex hull of the `interpolator` object.</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span> Indexes of outside points are <span style="color: #0000BB;">"1"</span>, <span style="color: #0000BB;">"2"</span>, <span style="color: #0000BB;">"3"</span>, <span style="color: #0000BB;">"79"</span>, <span style="color: #0000BB;">"80"</span>, <span style="color: #0000BB;">"81"</span>, <span style="color: #0000BB;">"157"</span>, <span style="color: #0000BB;">"158"</span>,</span></span>
<span><span class="co">##   <span style="color: #0000BB;">"159"</span>, <span style="color: #0000BB;">"235"</span>, <span style="color: #0000BB;">"236"</span>, <span style="color: #0000BB;">"237"</span>, <span style="color: #0000BB;">"313"</span>, <span style="color: #0000BB;">"314"</span>, <span style="color: #0000BB;">"315"</span>, <span style="color: #0000BB;">"391"</span>, <span style="color: #0000BB;">"392"</span>, <span style="color: #0000BB;">"393"</span>, …,</span></span>
<span><span class="co">##   <span style="color: #0000BB;">"4381"</span>, and <span style="color: #0000BB;">"4382"</span></span></span></code></pre>
<pre><code><span><span class="co">## Warning: Some/All dates for points <span style="color: #0000BB;">1</span>, <span style="color: #0000BB;">2</span>, <span style="color: #0000BB;">3</span>, <span style="color: #0000BB;">4</span>, <span style="color: #0000BB;">5</span>, <span style="color: #0000BB;">6</span>, <span style="color: #0000BB;">7</span>, <span style="color: #0000BB;">8</span>, <span style="color: #0000BB;">9</span>, <span style="color: #0000BB;">10</span>, <span style="color: #0000BB;">11</span>, <span style="color: #0000BB;">12</span>, <span style="color: #0000BB;">13</span>, <span style="color: #0000BB;">14</span>, <span style="color: #0000BB;">15</span>,</span></span>
<span><span class="co">## <span style="color: #0000BB;">16</span>, <span style="color: #0000BB;">17</span>, <span style="color: #0000BB;">18</span>, …, <span style="color: #0000BB;">4445</span>, and <span style="color: #0000BB;">4446</span> have missing precipitation values, assuming clear</span></span>
<span><span class="co">## days when interpolating radiation for these days</span></span></code></pre>
<p>A warning is launched because some grid points (hopefully not many)
are outside the boundary box of the station data. At this point the
resulting data can be exported via netCDF, displayed using function
<code>spplot</code> or transformed into other spatio-temporal spatial
structures. Here we will first transform the output to package
<code>stars</code>:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>      <span class="fu"><a href="https://r-spatial.github.io/stars/reference/geom_stars.html" class="external-link">geom_stars</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">raster_interpolated</span><span class="op">[</span><span class="st">"MeanTemperature"</span>,,,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"2020-01-01"</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>      <span class="fu"><a href="https://r-spatial.github.io/stars/reference/geom_stars.html" class="external-link">geom_stars</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">raster_interpolated</span><span class="op">[</span><span class="st">"MeanTemperature"</span>,,,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"2020-07-01"</span><span class="op">)</span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="interpolation-senegal_files/figure-html/unnamed-chunk-20-1.png" width="672"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Miquel De Cáceres, Víctor Granda, Nicolas Martin, Antoine Cabon.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
